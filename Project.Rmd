---
title: "Data Analytics 2025"
author: "Guillem Plademunt, Bernat Garcia, Javier Ezquerro and Marc Soriano"
output: 
  html_document:
    theme:
      bootswatch: flatly
      base_font: {google: "Open Sans"}
      size: 0.55rem              
      heading_font:
        google: "Lato"
    toc: true
    toc_depth: 3
    toc_float:
      collapsed: false
      smooth_scroll: true
    number_sections: true
    highlight: textmate
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(knitr)
library(kableExtra)
library(dplyr)
#library(rpart)
#library(rpart.plot)
#library(caret)
```

------------------------------------------------

# Descriptive Analytics

Before we start with any analysis, we need to understand the data that is available and the general distribution of the variables, in terms of central tendency and dispersion. Also, visualisation helps understand the data.

```{r}
# Read the file
DS <- read.csv("gaming_data.csv")
colnames(DS)
```


## Descriptive metrics

We created a function to calculate the descriptive metrics (playtime, sessions, levels completed, and spending) for all users, Premium users, and Freemium users. Then, we generated the Premium and Freemium datasets, applied the function to each segment, and finally used kableExtra to display the results in clean, formatted tables.

```{r}

# 1 Function to compute descriptive metrics

describe_segment <- function(df, segment_name) 
{
  data.frame(
    Segment = segment_name,
    Variable = c("playtime", "sessions", "levels", "spending"),
    Average = c(mean(df$playtime),
                mean(df$sessions),
                mean(df$levels),
                mean(df$spending)),
    StandardDeviation = c(sd(df$playtime),
                          sd(df$sessions),
                          sd(df$levels),
                          sd(df$spending))
  )
}

# 2 Premium and Freemium datasets

DS_Premium  <- DS[DS$user_type == "Premium", ]
DS_Freemium <- DS[DS$user_type == "Freemium", ]

# 3 Generate all tables

global_table   <- describe_segment(DS,          "All users")
premium_table  <- describe_segment(DS_Premium,  "Premium")
freemium_table <- describe_segment(DS_Freemium, "Freemium")

# ---- GLOBAL TABLE ----
global_table %>%
  kable(format = "html", digits = 2,
        caption = "Global - Descriptive Metrics") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  column_spec(1, bold = TRUE) %>%
  column_spec(2, bold = TRUE) %>%
  column_spec(3, color = "blue") %>%
  column_spec(4, color = "darkred")

# ---- PREMIUM TABLE ----
premium_table %>%
  kable(format = "html", digits = 2,
        caption = "Premium Users - Descriptive Metrics") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  column_spec(1, bold = TRUE) %>%
  column_spec(2, bold = TRUE) %>%
  column_spec(3, color = "blue") %>%
  column_spec(4, color = "darkred")

# ---- FREEMIUM TABLE ----
freemium_table %>%
  kable(format = "html", digits = 2,
        caption = "Freemium Users - Descriptive Metrics") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  column_spec(1, bold = TRUE) %>%
  column_spec(2, bold = TRUE) %>%
  column_spec(3, color = "blue") %>%
  column_spec(4, color = "darkred")

```

## Game Performance Metrics 
Using the data available in the dataset, we computed the following game performance metrics: ARPU, ARPPU, conversion rate and average engagement index.

```{r}
# ARPU
ARPU <- mean(DS$spending)

# ARPPU
paying_users <- DS[DS$spending > 0,]
ARPPU <- mean(paying_users$spending)

# Conversion Rate
conversion_rate <- nrow(paying_users) / nrow(DS)

# Engagement index per player
DS$engagement_index <- DS$playtime * DS$sessions

# Average Engagement Index
avg_engagement <- mean(DS$engagement_index)

# Results
metrics <- data.frame(
  Metric = c("ARPU", "ARPPU", "Conversion Rate", "Average Engagement Index"),
  Value = c(ARPU, ARPPU, conversion_rate, avg_engagement)
)

metrics %>%
  kable(caption = "Game Performance Metrics", format = "html", digits = 2, align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  row_spec(0, bold = TRUE, background = "#f2f2f2")
```

------------------------------------------------

# Visuals

#1

This code creates a pie chart showing the percentages of Premium vs Freemium users.
It counts the number of users of each type and converts it to percentages.
The chart displays proportional sections with the percentage labels inside each slice.
It allows a quick visual comparison of the distribution of user types in the dataset.

```{r}
#1
# Percentage of paying users versus non paying users.
percent_summary <- DS %>%
  group_by(user_type) %>%
  summarise(count = n()) %>%
  mutate(percent = count / sum(count) * 100)

ggplot(percent_summary, aes(x = "", y = percent, fill = user_type)) +
  geom_col(width = 1, color = "white") +   
  coord_polar(theta = "y") +               
  geom_text(aes(label = paste0(round(percent,1), "%")),
            position = position_stack(vjust = 0.5)) +  
  labs(title = "Percentage of paying users versus non paying users") +
  theme_void()                      
```
<br>
<br>
<br>
<br>
#2

This code creates a boxplot comparing playtime between group A and group B.
It first calculates an engagement index as playtime * sessions, although the plot shows only playtime.
Each box shows the median, quartiles, and outliers for each group.
It allows visual comparison of how playtime differs between the two groups.

```{r}
#2
# Boxplot comparing playtime and engagement of group A vs. group B.
DS <- DS %>%
  mutate(engagement = playtime * sessions)

# Boxplot de playtime per grup
ggplot(DS, aes(x = group, y = playtime, fill = group)) +
  geom_boxplot() +
  labs(title = "Boxplot: Playtime by Group (A vs B)",
       x = "Group",
       y = "Playtime (minutes)") +
  theme_minimal()

```
<br>
<br>
<br>
<br>
#3

This code creates a line plot showing the relationship between sessions and levels completed.
Each group (A and B) is represented with a different color.
Points show actual values, and lines connect them to highlight trends.
It allows visual comparison of how levels completed change with sessions for each group.
```{r}
#3
# Line plot: Levels completed vs Sessions per Group
ggplot(DS, aes(x = sessions, y = levels, color = group)) +
  geom_line() +
  geom_point() +
  labs(title = "Levels completed vs Sessions per Group",
       x = "Number of Sessions",
       y = "Average Levels Completed",
       color = "Group") +
  theme_minimal()

```

------------------------------------------------

# AB testing

## Test 1

The designers aim to investigate whether the players will have a playtime greater than 60 minutes in average.
Can you answer this question using the current sample? Use a confidence level of 95%.

### Research question

### Hypotheses

### Type of test

### Computations

### Interpretation



## Test 2

The indie studio tested two different versions of the game on the current users. 
The users labeled as A downloaded the standard version of the game, while users in group B downloaded a new version with an improved reward system.
The designers believed that the new reward system will produce higher playtime among the users. 
Can you search in the data whether there is evidence to do such claim with
95\% confidence level?

### Research question
Does the new version of the game with an improved reward system (Group B) result in higher average playtime compared to the standard version (Group A)?

### Hypotheses
Null hypothesis: H0: μB ≤ μA
<br>
Alternative hypothesis: H1: μB > μA 

### Type of test
Two independent samples, one-tailed test, upper tail.

### Computations

```{r}
# Sample sizes
n_A <- sum(DS$group == "A")
n_B <- sum(DS$group == "B")

# Sample means
mean_A <- mean(DS$playtime[DS$group == "A"])
mean_B <- mean(DS$playtime[DS$group == "B"])

# Sample variances
var_A <- var(DS$playtime[DS$group == "A"])
var_B <- var(DS$playtime[DS$group == "B"])

# Observed value
t_obs <- (mean_B - mean_A) / sqrt(var_B/n_B + var_A/n_A)

# Degrees of freedom
df_num <- (var_B/n_B + var_A/n_A)^2
df_den <- ( (var_B/n_B)^2 / (n_B - 1) ) + ( (var_A/n_A)^2 / (n_A - 1) )
df <- df_num / df_den

# Critical t-value (upper tail)
t_crit <- qt(0.95, df)

# p-value
p_val <- 1 - pt(t_obs, df)
```

Sample sizes: nA = 767, nB = 733

Means: XA = 55.50, XB = 64.81

Variances:s^2A = 104.12, S^2B = 92.766

Observed t-value: tobs = 18.17

Critical t-value (upper tail, 95%): tcrit = 1.6458

p-value: p ≈ 0

Degrees of freedom (df) ~ 1497.77

tobs = 18.17 vs tcrit = 1.65
<br>
Since, 
<br>
tobs > tcrit. 
<br>
We reject the null hypothesis.

### Interpretation
With 95% confidence, the new version of the game with the improved reward system (Group B) results in higher average playtime than the standard version (Group A).

On average, players in Group B played 64.81 minutes per session, while players in Group A played 55.50 minutes.

The difference is significant, and the evidence strongly supports the designers’ claim.

------------------------------------------------

# Regression analysis

In this section, we'll build a regression model to assess whether the player's spending amount
can be predicted based on the other variables.
 
## Regression model with numerical variables 

```{r}

# variables: playtime sessions, levels, friends and skill_score.

DS_Predict_Regression <- DS[, c("sessions", "levels", "friends", "skill_score", "playtime", "spending")]
model <- lm( spending ~ ., DS_Predict_Regression)
summary(model)

```
In the results, we can observe that the model is not precise. The R-squared value is 0.002, which indicates that the model explains only 0.2% of the variability in the dependent variable. This extremely low value suggests that the model has almost no explanatory power.

A well-fitting regression model would normally present an R-squared value closer to 1, meaning that a larger proportion of the variance in the outcome variable is accounted for by the predictors. In this case, the R-squared value demonstrates that the model does not adequately capture the relationship between the variables.

## Prediction

In this section, we use the previously fitted regression model to predict the spending behavior of a specific user profile. First, we define a hypothetical user with fixed characteristics and obtain the predicted spending value produced by the model.

Next, we run a simulation to analyse how predicted spending changes as playtime increases. To do this, we generate a sequence of playtime values ranging from 100 to 1000 (in steps of 50) while holding all other variables constant. Using this simulated dataset, we compute the predicted spending for each level of playtime.

Finally, we present the resulting prediction table and generate a scatter plot with a fitted linear regression line to visualise the relationship between playtime and predicted spending.

```{R}
# Create a random data frame
random_user <- data.frame(
  playtime = 200, 
  sessions = 10, 
  levels = 5,
  friends =100, 
  skill_score=60
)

# Predict the spending using the previous model
predict(model, random_user)

# Create a new simulation
playtime_seq <- seq(100,1000,50)
simulation <- data.frame(
  playtime = playtime_seq, 
  sessions = 10,
  levels = 5,
  friends =100,
  skill_score=60
  )

simulation$spending<-predict(model, simulation)
print(simulation)

# Create the plot
ggplot(simulation, aes(x = playtime, y = spending))+ 
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "red")

```

## Regression model with numerical and categorical variables 

In this step, we fit a multiple linear regression model that includes both numerical and categorical predictors. This allows us to evaluate how each variable contributes to explaining spending while controlling for the others. 

```{R}

model_categorical <- lm(spending ~., DS)
summary(model_categorical)

```
The model has very low explanatory power (R² = 0.02), so it is not accurate. The variable user_typePremium is the only significant predictor: Premium users spend, on average, about 14.45 units more than Freemium users. The group variable (groupB) is not statistically significant, so we cannot conclude that Group B spends more or less than Group A.

-----------------------------------------------------------------------

# Classification analysis


## Data splits
## Build a decision tree 

## Evaluate the tree

## Tree visualisation


## Train a K-NN algorithm


## Evaluate the K-NN algorithm


## Evaluate and compare



---------------------------------

# Conclusions

## Insights

## Learnings


-----------------

# Distribution of tasks





