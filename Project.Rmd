---
title: "Data Analytics 2025"
author: "Guillem Plademunt, Bernat Garcia, Javier Ezquerro and Marc Soriano"
output: 
  html_document:
    theme:
      bootswatch: flatly
      base_font: {google: "Open Sans"}
      size: 0.55rem              
      heading_font:
        google: "Lato"
    toc: true
    toc_depth: 3
    toc_float:
      collapsed: false
      smooth_scroll: true
    number_sections: true
    highlight: textmate
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(knitr)
library(kableExtra)
library(dplyr)
#library(rpart)
#library(rpart.plot)
#library(caret)
```

-----------------------------


# Descriptive Analytics

Before we start with any analysis, we need to understand the data that is available and the general distribution of the variables, in terms of central tendency and dispersion. Also, visualisation helps understand the data.

```{r}
#read the file
DS <- read.csv("gaming_data.csv")
colnames(DS)
```


## Descriptive metrics

We created a function to calculate the descriptive metrics (playtime, sessions, levels completed, and spending) for all users, Premium users, and Freemium users. Then, we generated the Premium and Freemium datasets, applied the function to each segment, and finally used kableExtra to display the results in clean, formatted tables.

```{r}

# ----------------------------------------------------------
# 1. Helper function to compute descriptive metrics
# ----------------------------------------------------------

describe_segment <- function(df, segment_name) 
{
  data.frame(
    Segment = segment_name,
    Variable = c("playtime", "sessions", "levels", "spending"),
    Average = c(mean(df$playtime),
                mean(df$sessions),
                mean(df$levels),
                mean(df$spending)),
    StandardDeviation = c(sd(df$playtime),
                          sd(df$sessions),
                          sd(df$levels),
                          sd(df$spending))
  )
}

# ----------------------------------------------------------
# 2. Create Premium and Freemium datasets
# ----------------------------------------------------------

DS_Premium  <- DS[DS$user_type == "Premium", ]
DS_Freemium <- DS[DS$user_type == "Freemium", ]

# ----------------------------------------------------------
# 3. Generate all descriptive tables using the helper function
# ----------------------------------------------------------

global_table   <- describe_segment(DS,          "All users")
premium_table  <- describe_segment(DS_Premium,  "Premium")
freemium_table <- describe_segment(DS_Freemium, "Freemium")

# ----------------------------------------------------------
# 4. Display each table separately with kableExtra
# ----------------------------------------------------------

# ---- GLOBAL TABLE ----
global_table %>%
  kable(format = "html", digits = 2,
        caption = "Global - Descriptive Metrics") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  column_spec(1, bold = TRUE) %>%
  column_spec(2, bold = TRUE) %>%
  column_spec(3, color = "blue") %>%
  column_spec(4, color = "darkred")

# ---- PREMIUM TABLE ----
premium_table %>%
  kable(format = "html", digits = 2,
        caption = "Premium Users - Descriptive Metrics") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  column_spec(1, bold = TRUE) %>%
  column_spec(2, bold = TRUE) %>%
  column_spec(3, color = "blue") %>%
  column_spec(4, color = "darkred")

# ---- FREEMIUM TABLE ----
freemium_table %>%
  kable(format = "html", digits = 2,
        caption = "Freemium Users - Descriptive Metrics") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  column_spec(1, bold = TRUE) %>%
  column_spec(2, bold = TRUE) %>%
  column_spec(3, color = "blue") %>%
  column_spec(4, color = "darkred")

```
## Game Performance Metrics 
Using the data available in the dataset, we computed the following game performance metrics: ARPU, ARPPU, conversion rate and average engagement index.

```{r}
# ARPU
ARPU <- mean(DS$spending)

# ARPPU
paying_users <- DS[DS$spending > 0,]
ARPPU <- mean(paying_users$spending)

# Conversion Rate
conversion_rate <- nrow(paying_users) / nrow(DS)

# Engagement index per player
DS$engagement_index <- DS$playtime * DS$sessions

# Average Engagement Index
avg_engagement <- mean(DS$engagement_index)

# Results
metrics <- data.frame(
  Metric = c("ARPU", "ARPPU", "Conversion Rate", "Average Engagement Index"),
  Value = c(ARPU, ARPPU, conversion_rate, avg_engagement)
)

kableExtra::kable(metrics, caption = "Game Performance Metrics")
```
------------------------------------------------

# Visuals

#1
<br>
This code creates a pie chart showing the percentages of Premium vs Freemium users.
It counts the number of users of each type and converts it to percentages.
The chart displays proportional sections with the percentage labels inside each slice.
It allows a quick visual comparison of the distribution of user types in the dataset.

```{r}
#1
# Percentage of paying users versus non paying users.
percent_summary <- DS %>%
  group_by(user_type) %>%
  summarise(count = n()) %>%
  mutate(percent = count / sum(count) * 100)

ggplot(percent_summary, aes(x = "", y = percent, fill = user_type)) +
  geom_col(width = 1, color = "white") +   
  coord_polar(theta = "y") +               
  geom_text(aes(label = paste0(round(percent,1), "%")),
            position = position_stack(vjust = 0.5)) +  
  labs(title = "Percentage of paying users versus non paying users") +
  theme_void()                      
```
<br>
<br>
<br>
<br>
#2
<br>
This code creates a boxplot comparing playtime between group A and group B.
It first calculates an engagement index as playtime * sessions, although the plot shows only playtime.
Each box shows the median, quartiles, and outliers for each group.
It allows visual comparison of how playtime differs between the two groups.

```{r}
#2
# Boxplot comparing playtime and engagement of group A vs. group B.
DS <- DS %>%
  mutate(engagement = playtime * sessions)

# Boxplot de playtime per grup
ggplot(DS, aes(x = group, y = playtime, fill = group)) +
  geom_boxplot() +
  labs(title = "Boxplot: Playtime by Group (A vs B)",
       x = "Group",
       y = "Playtime (minutes)") +
  theme_minimal()

```
<br>
<br>
<br>
<br>
#3
<br>
This code creates a line plot showing the relationship between sessions and levels completed.
Each group (A and B) is represented with a different color.
Points show actual values, and lines connect them to highlight trends.
It allows visual comparison of how levels completed change with sessions for each group.
```{r}
#3
# Line plot: Levels completed vs Sessions per Group
ggplot(DS, aes(x = sessions, y = levels, color = group)) +
  geom_line() +
  geom_point() +
  labs(title = "Levels completed vs Sessions per Group",
       x = "Number of Sessions",
       y = "Average Levels Completed",
       color = "Group") +
  theme_minimal()

```

------------------------------------------------------------


# AB testing

## Test 1

The designers aim to investigate whether the players will have a playtime greater than 60 minutes in average.
Can you answer this question using the current sample? Use a confidence level of 95%.

### Research question

### Hypotheses

### Type of test

### Computations


### Interpretation



## Test 2

The indie studio tested two different versions of the game on the current users. 
The users labeled as A downloaded the standard version of the game, while users in group B downloaded a new version with an improved reward system.
The designers believed that the new reward system will produce higher playtime among the users. 
Can you search in the data whether there is evidence to do such claim with
95\% confidence level?


### Research question

### Hypotheses

### Type of test

### Computations


### Interpretation





----------------

# Regression analysis

In this section, we'll build a regression model to assess whether the player's spending amount
can be predicted based on the other variables.
 
## Regression model with numerical variables 

## Prediction

## Regression model with numerical and categorical variables 




-----------------------------------------------------------------------

# Classification analysis


## Data splits
## Build a decision tree 

## Evaluate the tree

## Tree visualisation


## Train a K-NN algorithm


## Evaluate the K-NN algorithm


## Evaluate and compare



---------------------------------

# Conclusions

## Insights

## Learnings


-----------------

# Distribution of tasks





